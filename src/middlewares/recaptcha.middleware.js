require('dotenv').config();
const axios = require('axios');

module.exports = async (req, res, next) => {
    try {
        recaptchaResponse = req.body['g-recaptcha-response'];
        delete req.body['g-recaptcha-response'];
        delete req.body['action'];
        if (recaptchaResponse) {
            var verifyRecaptcha = `https://www.google.com/recaptcha/api/siteverify?secret=${process.env.RECAPTCHA_SECRET}&response=${recaptchaResponse}&remoteip=${req.connection.remoteAddress}`;
            const verified = await axios.post(verifyRecaptcha);
            if (verified.data.success) return next();
        }
        req.flash('notify', {
            type: 'error',
            message: 'Recaptcha inv√°lido!',
        });
        return res.redirect('/');
    } catch (err) {
        return res.render('errors/500');
    }
};